<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mis Solicitudes | Técnico</title>
    <link rel="stylesheet" href="/css/mis_solicitudes.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="admin-navbar">
        <div class="nav-container">
            <a th:href="@{/tecnico}" class="nav-brand">
                <i class="bi bi-tools"></i>
                <span>Panel de Técnico</span>
            </a>
            <div class="nav-menu">
                <a th:href="@{/tecnico}" class="nav-link">Inicio</a>
                <a th:href="@{/tecnico/mios}" class="nav-link">Mis Mantenimientos</a>
                <a th:href="@{/tecnico/mis-solicitudes}" class="nav-link active">Mis Solicitudes</a>
                <form th:action="@{/logout}" method="post" class="nav-form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="btn-logout">
                        <i class="bi bi-box-arrow-right"></i>
                        <span>Salir</span>
                    </button>
                </form>
            </div>
        </div>
    </nav>

    <main class="main-container">
        <!-- Header -->
        <div class="page-header">
            <div class="header-content">
                <h1 class="page-title">Mis Solicitudes de Repuestos</h1>
                <p class="page-subtitle">Revisa el estado de tus solicitudes de repuestos</p>
            </div>
            <div class="header-actions">
                <a th:href="@{/tecnico}" class="btn-secondary">
                    <i class="bi bi-arrow-left"></i>
                    <span>Volver al Inicio</span>
                </a>
                <a th:href="@{/tecnico/crear-solicitud}" class="btn-primary">
                    <i class="bi bi-plus-circle"></i>
                    <span>Nueva Solicitud</span>
                </a>
            </div>
        </div>

        <!-- Filtros -->
        <div class="filters-section">
            <div class="filters-container">
                <div class="filter-group">
                    <label for="filterEstado">Estado:</label>
                    <select id="filterEstado" class="filter-select">
                        <option value="">Todos los estados</option>
                        <option value="PENDIENTE">Pendiente</option>
                        <option value="APROBADA">Aprobada</option>
                        <option value="RECHAZADA">Rechazada</option>
                        <option value="PROCESADA">Procesada</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterFecha">Fecha:</label>
                    <select id="filterFecha" class="filter-select">
                        <option value="">Todas las fechas</option>
                        <option value="today">Hoy</option>
                        <option value="week">Última semana</option>
                        <option value="month">Último mes</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterSearch">Buscar:</label>
                    <input type="text" id="filterSearch" class="filter-input" placeholder="Buscar en solicitudes...">
                </div>
                <div class="filter-actions">
                    <button type="button" class="btn-secondary" onclick="clearFilters()">
                        <i class="bi bi-arrow-clockwise"></i>
                        Limpiar
                    </button>
                </div>
            </div>
        </div>

        <!-- Estadísticas -->
        <div class="stats-section">
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="bi bi-list-check"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-number" id="totalSolicitudes">0</span>
                        <span class="stat-label">Total</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon pending">
                        <i class="bi bi-clock"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-number" id="pendingSolicitudes">0</span>
                        <span class="stat-label">Pendientes</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon approved">
                        <i class="bi bi-check-circle"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-number" id="approvedSolicitudes">0</span>
                        <span class="stat-label">Aprobadas</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon processed">
                        <i class="bi bi-gear"></i>
                    </div>
                    <div class="stat-content">
                        <span class="stat-number" id="processedSolicitudes">0</span>
                        <span class="stat-label">Procesadas</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Lista de Solicitudes -->
        <div class="solicitudes-section">
            <div class="section-header">
                <h2 class="section-title">Historial de Solicitudes</h2>
                <div class="section-actions">
                    <button type="button" class="btn-secondary" onclick="loadSolicitudes()">
                        <i class="bi bi-arrow-clockwise"></i>
                        Actualizar
                    </button>
                    <button type="button" class="btn-secondary" onclick="exportSolicitudes()">
                        <i class="bi bi-download"></i>
                        Exportar
                    </button>
                </div>
            </div>

            <div class="solicitudes-list" id="solicitudesList">
                <!-- Solicitudes cargadas desde el servidor -->
                <div th:if="${solicitudes != null and !solicitudes.empty}" class="solicitudes-container">
                    <div th:each="solicitud : ${solicitudes}" class="solicitud-card" th:attr="data-estado=${solicitud.estado}, 
                                 data-fecha=${#temporals.format(solicitud.creadaEn, 'yyyy-MM-dd')}">
                        <div class="solicitud-header">
                            <div class="solicitud-title">
                                <h3 th:text="'SOL-' + ${solicitud.id} + ' - ' + ${solicitud.codigoMaquina}">
                                    SOL-001 - PHT-001
                                </h3>
                                <div class="solicitud-status">
                                    <span
                                        th:classappend="'status-badge status-' + ${#strings.toLowerCase(solicitud.estado)}"
                                        th:text="${solicitud.estado}">
                                        PENDIENTE
                                    </span>
                                    <span class="date-badge"
                                        th:text="${#temporals.format(solicitud.creadaEn, 'dd/MM/yyyy HH:mm')}">
                                        15/01/2024 10:30
                                    </span>
                                </div>
                            </div>
                            <div class="solicitud-actions">
                                <button type="button" class="btn-icon" th:onclick="|showSolicitudDetails(this)|">
                                    <i class="bi bi-info-circle"></i>
                                </button>
                                <button type="button" class="btn-icon" th:onclick="|copySolicitudInfo(this)|">
                                    <i class="bi bi-clipboard"></i>
                                </button>
                            </div>
                        </div>

                        <div class="solicitud-body">
                            <div class="solicitud-info">
                                <div class="info-grid">
                                    <div class="info-item">
                                        <label>Mantenimiento:</label>
                                        <span
                                            th:text="${solicitud.mantenimiento != null} ? 'MT-' + ${solicitud.mantenimiento.id} : 'N/A'">
                                            MT-001
                                        </span>
                                    </div>
                                    <div class="info-item">
                                        <label>Máquina:</label>
                                        <span th:text="${(solicitud.mantenimiento != null and solicitud.mantenimiento.maquina != null)} ? 
                                                       ${solicitud.mantenimiento.maquina.nombre} : 'N/A'">
                                            Prensa Hidráulica
                                        </span>
                                    </div>
                                    <div class="info-item">
                                        <label>Código Máquina:</label>
                                        <span th:text="${solicitud.codigoMaquina} ?: 'N/A'">PHT-001</span>
                                    </div>
                                    <div class="info-item">
                                        <label>Motivo:</label>
                                        <span th:text="${solicitud.motivo} ?: 'Solicitud de técnico'">
                                            Solicitud de técnico
                                        </span>
                                    </div>
                                </div>

                                <div class="descripcion-section">
                                    <label>Descripción del Repuesto:</label>
                                    <div class="descripcion-content"
                                        th:text="${solicitud.descripcion} ?: 'Sin descripción'">
                                        Se requiere repuesto para el sistema hidráulico...
                                    </div>
                                </div>

                                <div th:if="${solicitud.observaciones}" class="observaciones-section">
                                    <label>Observaciones del Líder:</label>
                                    <div class="observaciones-content" th:text="${solicitud.observaciones}">
                                        Observaciones del líder...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estado vacío -->
                <div th:if="${solicitudes == null or solicitudes.empty}" class="empty-state">
                    <div class="empty-icon">
                        <i class="bi bi-inbox"></i>
                    </div>
                    <h3>No hay solicitudes de repuestos</h3>
                    <p>No has creado ninguna solicitud de repuestos todavía.</p>
                    <div class="empty-actions">
                        <a th:href="@{/tecnico/crear-solicitud}" class="btn-primary">
                            <i class="bi bi-plus-circle"></i>
                            <span>Crear Primera Solicitud</span>
                        </a>
                        <a th:href="@{/tecnico/mios}" class="btn-secondary">
                            <i class="bi bi-list-check"></i>
                            <span>Ver Mis Mantenimientos</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para detalles -->
    <div id="solicitudModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalTitle">Detalles de Solicitud</h3>
                <button type="button" class="btn-close" onclick="closeModal()">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
            </div>
        </div>
    </div>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    
    <script src="/js/mis_solicitudes.js"></script>
</body>

</html>