<!doctype html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Repuestos solicitados</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{background:#0f172a;color:#e5e7eb}
    .card{border:0;border-radius:14px;box-shadow:0 10px 24px rgba(0,0,0,.25)}
    .table-dark{--bs-table-bg:#111827;--bs-table-striped-bg:#0f1625}
    .badge-soft{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.15)}
  </style>
</head>
<body class="container py-5">

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold text-warning m-0">Repuestos solicitados</h3>
    <a th:href="@{/lider}" class="btn btn-outline-light">Volver</a>
  </div>

  <!-- Mensajes -->
  <div th:if="${param.ok}" class="alert alert-success">Operación exitosa</div>
  <div th:if="${param.error}" class="alert alert-danger">
    <span th:text="${param.error}">Ha ocurrido un error.</span>
  </div>

  <div class="card bg-dark p-4">
    <div class="table-responsive">
      <table class="table table-dark table-hover align-middle m-0">
        <thead>
          <tr>
            <th>#</th>
            <th>Mantenimiento</th>
            <th>Máquina</th>
            <th>Motivo</th>
            <th>Descripción</th>
            <th>Creada</th>
            <th>Estado</th>
          </tr>
        </thead>
        <tbody>
          <!-- IMPORTANTE: usa exactamente 'solicitudes' como en el controlador -->
          <tr th:each="s, it : ${solicitudes}">
            <td th:text="${it.index + 1}">1</td>

            <!-- Mantenimiento puede ser null si la FK no está cargada -->
            <td>
              <span th:text="${s.mantenimiento != null ? s.mantenimiento.id : '—'}">—</span>
              <div class="small text-secondary"
                   th:text="${s.mantenimiento != null && s.mantenimiento.tipo != null ? s.mantenimiento.tipo : ''}">
                PREVENTIVO
              </div>
            </td>

            <!-- Máquina: navega sólo si mantenimiento y máquina existen -->
            <td>
              <span th:text="${(s.mantenimiento != null && s.mantenimiento.maquina != null) ? s.mantenimiento.maquina.codigo : (s.codigoMaquina != null ? s.codigoMaquina : '—')}">
                MAQ-001
              </span>
              <div class="small text-secondary"
                   th:text="${(s.mantenimiento != null && s.mantenimiento.maquina != null) ? s.mantenimiento.maquina.nombre : ''}">
                Nombre de máquina
              </div>
            </td>

            <td th:text="${s.motivo}">Solicitud de técnico</td>
            <td th:text="${s.descripcion}">Detalle</td>

            <!-- Para formatear fechas usa thymeleaf-extras-java8time -->
            <td th:text="${s.creadaEn != null ? #temporals.format(s.creadaEn, 'dd/MM/yyyy HH:mm') : '—'}">01/10/2025</td>

            <td>
              <span th:classappend="${s.aprobado} ? 'badge bg-success' : 'badge bg-warning text-dark'"
                    th:text="${s.aprobado} ? 'Aprobado' : 'Pendiente'">Pendiente</span>
            </td>
          </tr>

          <tr th:if="${#lists.isEmpty(solicitudes)}">
            <td colspan="7" class="text-center text-secondary py-4">Sin solicitudes</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
