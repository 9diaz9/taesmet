<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Seleccionar Mantenimiento | Técnico</title>
    <link rel="stylesheet" href="/css/seleccionar_mtto.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="admin-navbar">
        <div class="nav-container">
            <a href="/tecnico" class="nav-brand">
                <i class="bi bi-tools"></i>
                <span>Panel de Técnico</span>
            </a>
            <div class="nav-menu">
                <a href="/tecnico" class="nav-link">Inicio</a>
                <a href="/tecnico/mios" class="nav-link">Mis Mantenimientos</a>
                <a href="/tecnico/mis-solicitudes" class="nav-link">Mis Solicitudes</a>
                <form th:action="@{/logout}" method="post" class="nav-form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="btn-logout">
                        <i class="bi bi-box-arrow-right"></i>
                        <span>Salir</span>
                    </button>
                </form>
            </div>
        </div>
    </nav>

    <main class="main-container">
        <!-- Header -->
        <div class="page-header">
            <div class="header-content">
                <h1 class="page-title">Crear Solicitud de Repuesto</h1>
                <p class="page-subtitle">Selecciona el mantenimiento para el cual necesitas solicitar repuestos</p>
            </div>
            <div class="header-actions">
                <a href="/tecnico" class="btn-secondary">
                    <i class="bi bi-arrow-left"></i>
                    <span>Volver al Inicio</span>
                </a>
                <a href="/tecnico/mios" class="btn-secondary">
                    <i class="bi bi-list-check"></i>
                    <span>Ver Mantenimientos</span>
                </a>
            </div>
        </div>

        <!-- Información de Contexto -->
        <div class="info-card">
            <div class="info-header">
                <i class="bi bi-info-circle"></i>
                <h3>Información Importante</h3>
            </div>
            <div class="info-body">
                <div class="info-content">
                    <p>Selecciona uno de tus mantenimientos activos para crear una solicitud de repuestos. Solo se
                        muestran mantenimientos que están en estado <strong>Pendiente</strong>, <strong>En
                            Proceso</strong> o <strong>En Espera de Repuestos</strong>.</p>
                </div>
                <div class="info-tips">
                    <div class="tip-item">
                        <i class="bi bi-check-circle"></i>
                        <span>Selecciona el mantenimiento que requiere el repuesto</span>
                    </div>
                    <div class="tip-item">
                        <i class="bi bi-check-circle"></i>
                        <span>Describe detalladamente el repuesto necesario</span>
                    </div>
                    <div class="tip-item">
                        <i class="bi bi-check-circle"></i>
                        <span>Incluye especificaciones técnicas y cantidad</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filtros Rápidos -->
        <div class="filters-card">
            <div class="filters-header">
                <i class="bi bi-funnel"></i>
                <h3>Filtrar Mantenimientos</h3>
            </div>
            <div class="filters-body">
                <div class="filter-group">
                    <label for="filterEstado">Estado:</label>
                    <select id="filterEstado" class="filter-select">
                        <option value="">Todos los estados</option>
                        <option value="PENDIENTE">Pendiente</option>
                        <option value="EN_PROCESO">En Proceso</option>
                        <option value="EN_ESPERA_REPUESTOS">En Espera de Repuestos</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterTipo">Tipo:</label>
                    <select id="filterTipo" class="filter-select">
                        <option value="">Todos los tipos</option>
                        <option value="CRITICO">Crítico</option>
                        <option value="PREVENTIVO_ELECTRICO">Preventivo Eléctrico</option>
                        <option value="PREVENTIVO_MECANICO">Preventivo Mecánico</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="filterSearch">Buscar:</label>
                    <input type="text" id="filterSearch" class="filter-input" placeholder="Buscar por máquina...">
                </div>
                <button type="button" class="btn-clear-filters" onclick="clearFilters()">
                    <i class="bi bi-x-circle"></i>
                    <span>Limpiar</span>
                </button>
            </div>
        </div>

        <!-- Lista de Mantenimientos -->
        <div class="mantenimientos-section">
            <div class="section-header">
                <h2 class="section-title">Tus Mantenimientos Activos</h2>
                <div class="section-stats">
                    <span class="stat-badge" id="totalMttos" th:text="${mttos != null ? mttos.size() : 0}">0</span>
                    <span class="stat-label">mantenimientos disponibles</span>
                </div>
            </div>

            <div class="mantenimientos-grid" id="mantenimientosGrid">
                <!-- Mantenimientos cargados desde el servidor -->
                <div th:if="${mttos != null and !mttos.empty}" class="mantenimientos-container">
                    <div th:each="mtto : ${mttos}" class="mtto-card" th:data-estado="${mtto.estado}"
                        th:data-tipo="${mtto.tipo}" th:data-mtto-id="${mtto.id}">

                        <div class="card-header">
                            <div class="mtto-title">
                                <h3 th:text="'MT-' + ${mtto.id}">MT-001</h3>
                                <span class="status-badge" th:text="${mtto.estado}">PENDIENTE</span>
                            </div>
                            <div class="mtto-actions">
                                <a th:href="@{/tecnico/repuestos/solicitar/{id}(id=${mtto.id})}" class="btn-select">
                                    <i class="bi bi-box-seam"></i>
                                    <span>Solicitar Repuesto</span>
                                </a>
                            </div>
                        </div>

                        <div class="card-body">
                            <div class="mtto-info">
                                <div class="info-item">
                                    <i class="bi bi-cpu"></i>
                                    <div class="info-content">
                                        <label>Máquina</label>
                                        <span th:text="${mtto.maquina?.nombre} ?: 'N/A'">Prensa Hidráulica</span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="bi bi-tag"></i>
                                    <div class="info-content">
                                        <label>Código</label>
                                        <span th:text="${mtto.maquina?.codigo} ?: 'N/A'">PHT-001</span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="bi bi-gear"></i>
                                    <div class="info-content">
                                        <label>Tipo Mantenimiento</label>
                                        <span th:text="${mtto.tipo}">PREVENTIVO_MECANICO</span>
                                    </div>
                                </div>
                                <div class="info-item">
                                    <i class="bi bi-calendar"></i>
                                    <div class="info-content">
                                        <label>Programado</label>
                                        <span th:text="${mtto.programadoPara} ?: 'No programado'">2024-01-15</span>
                                    </div>
                                </div>
                            </div>

                            <div class="mtto-desc" th:if="${mtto.descripcion}">
                                <label>Descripción:</label>
                                <p th:text="${mtto.descripcion}">Mantenimiento preventivo programado para revisión
                                    general</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Estado vacío -->
                <div th:if="${mttos == null or mttos.empty}" class="empty-state">
                    <div class="empty-icon">
                        <i class="bi bi-inbox"></i>
                    </div>
                    <h3>No hay mantenimientos activos</h3>
                    <p>No tienes mantenimientos pendientes o en proceso para los cuales solicitar repuestos.</p>
                    <div class="empty-actions">
                        <a href="/tecnico/mios" class="btn-primary">
                            <i class="bi bi-eye"></i>
                            <span>Ver Todos los Mantenimientos</span>
                        </a>
                        <a href="/tecnico" class="btn-secondary">
                            <i class="bi bi-house"></i>
                            <span>Volver al Inicio</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <script src="/js/seleccionar_mtto.js"></script>
</body>

</html>